---
title: "Final Project (Group 2)"
author: "Group 2"
date: "`r Sys.Date()`"
output:
  pdf_document:
    toc: no
    df_print: kable
    fig_caption: no
    number_sections: no
    dev: pdf
    highlight: tango
  html_document:
    theme: default
    self_contained: yes
    toc: no
    df_print: kable
    fig_caption: no
    number_sections: no
    smart: yes
    dev: svg
  word_document:
    toc: no
geometry: margin=1in
fontsize: 11pt
documentclass: article
---

```{r setup, include = FALSE}
# DO NOT ALTER THIS CHUNK
knitr::opts_chunk$set(
  echo = TRUE,
  eval = TRUE,
  fig.width = 5,
  fig.asp = 0.618,
  out.width = "70%",
  dpi = 120,
  fig.align = "center",
  cache = FALSE
)
is_pdf <- try (("pdf_document" %in% 
                  rmarkdown::all_output_formats(knitr::current_input())), 
               silent=TRUE)
is_pdf <- (is_pdf == TRUE)

# Load required packages
suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(broom))
suppressPackageStartupMessages(library(modelr))
suppressPackageStartupMessages(library(plotly))
suppressPackageStartupMessages(library(readxl))
suppressPackageStartupMessages(library(infer))
suppressPackageStartupMessages(library(lubridate))
suppressPackageStartupMessages(library(geosphere))
suppressPackageStartupMessages(library(lubridate))
suppressPackageStartupMessages(library(infer))
suppressPackageStartupMessages(library(usmap))
suppressPackageStartupMessages(library(ggplot2))
suppressPackageStartupMessages(library(formattable))
suppressPackageStartupMessages(library(plotrix))
suppressPackageStartupMessages(library(ggpubr))
suppressPackageStartupMessages(library(boot))
suppressPackageStartupMessages(library(infer))
# Load Cohen's d bootstrap helper functions
load("bootstrap_cohens_d.RData")
```

<<<<<<< HEAD
-   Research Question/Hypothesis: What variable in the world happiness report (family, health, trust, generosity, and economics) has the greatest effect on a nation's happiness score?
=======

* Research Question/Hypothesis: 
What variable in the world happiness report (family, health, trust, generosity, and economics) has the greatest effect on a nationâ€™s happiness score? 
>>>>>>> 81e6af9ac23978bbafb85c9fa12c41d73c572ee5

-   Hypothesis: Economics plays the largest role in a nation's happiness score.

```{r}
library(readxl)
library(dplyr)
library(ggplot2)
library(tidyr)

data <- read_excel("2019.xls")

colnames(data)

```

```{r}
library(readxl)

data <- read_excel("2019.xls")

print(colnames(data))

data <- data %>%
  rename(
    Economy = `GDP per capita`,  
    Social = 'Social support',                      
    Health = `Healthy life expectancy`,
    Freedom = `Freedom to make life choices`,  
    Corruption = 'Perceptions of corruption', 
    Happiness_Score = `Score`
  )
print(colnames(data))

```

```{r}
  head(
    select(data, Economy, Social, Health, Freedom, Corruption, Happiness_Score)
  )
```

[Module 2: Junhyung Kim, Jiho Lee]

\*Scatter Plot

```{r}
qplot(x = Economy, y= Happiness_Score, data = data,
 geom = c("point", "smooth"), method = "lm") +
 labs(title =
 "Scatter Plot of Relationship Between
 Economy and Happiness Score",
 x = "Economy", y = "Happiness Score")
```

```{r}
 qplot(x= Social,y=Happiness_Score,data=data,
 geom=c("point","smooth"),method="lm")+
 labs(title =
 "Scatter Plot of Relationship Between
 Social and Happiness Score",
 x="Social",y="Happiness Score")
```

```{r}
qplot(x= Health,y=Happiness_Score,data=data,
 geom=c("point","smooth"),method="lm")+
 labs(title =
 "Scatter Plot of Relationship Between
 Health and Happiness Score",
 x="Health",y="Happiness Score")
```

```{r, warning = FALSE}
qplot(x= Freedom,y=Happiness_Score,data=data,
 geom=c("point","smooth"),method="lm")+
 labs(title =
 "Scatter Plot of Relationship Between
 Freedom and Happiness Score",
 x="Freedom",y="Happiness Score")
```

```{r, warning = FALSE}
 qplot(x= Corruption,y=Happiness_Score,data=data,
 geom=c("point","smooth"),method="lm")+
 labs(title ="Scatter Plot of Relationship Between
 Corruption and Happiness Score",
 x="Corruption",y="HappinessScore")
```

```{r}
data %>%
  ggplot() +
  geom_smooth(mapping = aes(x = Economy, y = Happiness_Score)) +
  labs(x = "Economy", y = "Happiness Score", 
       title="Trend line relationship between 
       Economy vs Happiness Score")
```

```{r}
data %>%
  ggplot() +
  geom_smooth(mapping = aes(x = Social, y = Happiness_Score)) +
  labs(x = "Social", y = "Happiness Score", 
       title="Trend line relationship between 
       Social vs Happiness Score")
```

```{r}
data %>%
  ggplot() +
  geom_smooth(mapping = aes(x = Health, y = Happiness_Score)) +
  labs(x = "Health", y = "Happiness Score", 
       title="Trend line relationship between 
       Health vs Happiness Score")
```

```{r}
data %>%
  ggplot() +
  geom_smooth(mapping = aes(x = Freedom, y = Happiness_Score)) +
  labs(x = "Freedom", y = "Happiness Score", 
       title="Trend line relationship between 
       Freedom vs Happiness Score")
```

```{r}
data %>%
  ggplot() +
  geom_smooth(mapping = aes(x = Corruption, y = Happiness_Score)) +
  labs(x = "Corruption", y = "Happiness Score", 
       title="Trend line relationship between 
       Corruption vs Happiness Score")
```

\*HeatMap

```{r}
data %>%
ggplot(aes(x = Economy, y = Happiness_Score)) +
  geom_bin2d(bins = 30) +  
  geom_smooth(method = "lm", se = FALSE) + 
  labs(title = "HeatMap with linearline 
                Economy vs Happiness Score", 
           x = "Economy", y = "Happiness_Score")
```


```{r}
data %>%
ggplot(aes(x = Social, y = Happiness_Score)) +
  geom_bin2d(bins = 30) +  
  geom_smooth(method = "lm", se = FALSE) + 
  labs(title = "HeatMap with linearline 
                Social vs Happiness Score", 
           x = "Social", y = "Happiness_Score")
```


```{r}
data %>%
ggplot(aes(x = Health, y = Happiness_Score)) +
  geom_bin2d(bins = 30) +  
  geom_smooth(method = "lm", se = FALSE) + 
  labs(title = "HeatMap with linearline 
                Health vs Happiness Score", 
           x = "Health", y = "Happiness_Score")
```


```{r}
data %>%
ggplot(aes(x = Freedom, y = Happiness_Score)) +
  geom_bin2d(bins = 30) +  
  geom_smooth(method = "lm", se = FALSE) + 
  labs(title = "HeatMap with linearline 
                Freedom and Happiness Score", 
           x = "Freedom", y = "Happiness_Score")
```


```{r}
data %>%
ggplot(aes(x = Corruption, y = Happiness_Score)) +
  geom_bin2d(bins = 30) +  
  geom_smooth(method = "lm", se = FALSE) + 
  labs(title = "HeatMap with linearline
                Corruption and Happiness Score", 
           x = "Corruption", y = "Happiness_Score")
```


======= [ Module 4: Eugene Kim, Harold Lee - Explanatory Data Analysis ]


```{r}
str(data, vec.len = 2)
head(
    select(data, Economy, Social, Health, Freedom, Corruption,
           Happiness_Score)
  )
tail(select(data, Economy, Social, Health, Freedom, Corruption,
            Happiness_Score)
  )
```

\*Summary statistics

\*Box Plot

```{r}
data_long <- data %>%
  gather(key = "Variable", value = "Score", Economy, Social, Health,
         Freedom, Corruption) 

ggplot(data_long, aes(x = Variable, y = Score)) +
  geom_boxplot(width = 0.7) + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(title = "Box Plot Each Variable",
       x = "Variables Affecting Happiness Score", y = "Values")
```

\*Violin Plot

```{r}
ggplot(data_long, aes(x = Variable, y = Score, fill = Variable)) +
  geom_violin(trim = TRUE) + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(title = "Violin Plot of Each Variable",
       x = "Variables Affecting Happiness Score", y = "Values") +
  scale_fill_brewer(palette = "Pastel1")
```

\*Summary

```{r}
data %>%
  summarize(
    mean= mean(Economy),
    median = median(Economy),
    sd = sd(Economy),
    iqr = IQR(Economy),
    min = min(Economy),
    max = max(Economy)
 )
```

```{r}
data %>%
  summarize(
    mean= mean(Social),
    median = median(Social),
    sd = sd(Social),
    iqr = IQR(Social),
    min = min(Social),
    max = max(Social)
 )
```

```{r}
data %>%
  summarize(
    mean= mean(Health),
    median = median(Health),
    sd = sd(Health),
    iqr = IQR(Health),
    min = min(Health),
    max = max(Health)
 )
```

```{r}
data %>%
  summarize(
    mean= mean(Freedom),
    median = median(Freedom),
    sd = sd(Freedom),
    iqr = IQR(Freedom),
    min = min(Freedom),
    max = max(Freedom)
 )
```

```{r}
data %>%
  summarize(
    mean= mean(Corruption),
    median = median(Corruption),
    sd = sd(Corruption),
    iqr = IQR(Corruption),
    min = min(Corruption),
    max = max(Corruption)
 )
```



```{r}
data_E <- data %>%
  summarize(
    mean= mean(Economy),
    median = median(Economy),
    sd = sd(Economy),
    iqr = IQR(Economy),
    min = min(Economy),
    max = max(Economy)
 )
```

```{r}
data_S <- data %>%
  summarize(
    mean= mean(Social),
    median = median(Social),
    sd = sd(Social),
    iqr = IQR(Social),
    min = min(Social),
    max = max(Social)
 )
```

```{r}
data_H <- data %>%
  summarize(
    mean= mean(Health),
    median = median(Health),
    sd = sd(Health),
    iqr = IQR(Health),
    min = min(Health),
    max = max(Health)
 )
```

```{r}
data_F <- data %>%
  summarize(
    mean= mean(Freedom),
    median = median(Freedom),
    sd = sd(Freedom),
    iqr = IQR(Freedom),
    min = min(Freedom),
    max = max(Freedom)
 )
```

```{r}
data_C <- data %>%
  summarize(
    mean= mean(Corruption),
    median = median(Corruption),
    sd = sd(Corruption),
    iqr = IQR(Corruption),
    min = min(Corruption),
    max = max(Corruption)
 )
```

```{r}
combined_data <- rbind(data_E, data_S, data_H, data_F, data_C)
row.names(combined_data) <- c("Economy", "Social", "Health", "Freedom", "Corruption")
print(combined_data)
```


# [Module 5: Chun Jin Park - Modeling].

# linear model using Im

```{r}
model <- lm(Happiness_Score ~ Economy + Social + Health + Freedom + Generosity
            + Corruption, data = data)

summary(model)
```

# tidy to get the model coefficients

```{r}
coefficients <- tidy(model)
print(coefficients)
```

# glance to get the model's performance metrics

```{r}
performance <- glance(model)
print(performance)
```

# Observed vs Predicted plot

```{r}
ggplot(data, aes(x = predict(model), y = Happiness_Score)) +
  geom_point() +
  geom_abline(intercept = 0, slope = 1, col = "red") +
  labs(title = 
         "Observed vs Predicted Happiness Score", 
       x = "Predicted Happiness Score", 
       y = "Observed Happiness Score")
```

# Residuals vs Predicted plot

```{r}
ggplot(data, aes(x = predict(model), y = residuals(model))) +
  geom_point() +
  geom_hline(yintercept = 0, col = "red") +
  labs(title = "Residuals vs Predicted Happiness Score",
       x = "Predicted Happiness Score", 
       y = "Residuals")
```

# Q-Q plot

```{r}
qqnorm(residuals(model))
qqline(residuals(model), col = "red")
```
<<<<<<< HEAD
=======

=======
[ Module 6: SeNa Julsdorf, Hyeongseok Sim] 

```{r}
null_distribution_correlation <- data %>%
  specify(Happiness_Score ~ Social) %>%
  hypothesize(null = "independence") %>%
  generate(reps = 10000, type = "permute") %>%
  calculate(stat = "correlation")
```

```{r}
happiness_obs_stat <- data %>%
  specify(Happiness_Score ~ Social) %>%
  calculate(stat = "correlation")
```

```{r}
p_value <- null_distribution_correlation %>%
  get_p_value(obs_stat = happiness_obs_stat, direction = "both")
```
```{r}
print(p_value)
```
```{r}
visualize(null_distribution_correlation) +
  shade_p_value(obs_stat = happiness_obs_stat, direction = "two_sided") +
    labs(title = "Null Distribution of Happiness Score", x = "Correlation",
         y = "Count")
```

```{r}
null_distribution_correlation %>%
  ggplot +
  geom_density(mapping = aes(x = stat), adjust = 5) +
  labs(title = "Null Hypothesis Density Plot", x = "stats", y = "density")
```


```{r}
null_distribution_correlation %>%
  ggplot() +
  geom_histogram(mapping = aes(x = stat), bins = 10) +
  geom_density(mapping = aes(x = stat), adjust = 10) +
  labs(title = "Null Hypothesis Density Plot", x = "stats", y = "density")
```

```{r}
null_distribution_correlation %>%
ggplot()+
geom_histogram(mapping = aes(x = stat, y = ..density..), bins = 10) +
geom_density(mapping = aes(x = stat), adjust = 5) +
labs(title = "Density and Null Hypothesis PMF Plot",
x = "Stat", y = "Density")
```





=======
[ Module 7: Jeonghwa Cho]



```{r}
bootstraps_distribution_correlation <- data %>%
specify(Happiness_Score ~ Social) %>%
generate( reps = 10000, type = "bootstrap") %>%
calculate(stat = "correlation")
```

```{r}
bootstrap_ci <- bootstraps_distribution_correlation %>%
get_confidence_interval()

```

```{r}
bootstrap_ci

```

```{r}
bootstraps_distribution_correlation %>%
visualize()+
shade_confidence_interval(bootstrap_ci)+
ggtitle("Bootstrap Distribution")+
xlab("Correlation")+
ylab("count")

```

```{r}
bootstrap_results <- cohens_d_bootstrap(
data = data_long,
model = Happiness_Score ~ Variable)

```

```{r}
bootstrap_report(bootstrap_results)

```

```{r}
plot_ci(bootstrap_results)

```

