---
title: "Final Project (Group 2)"
author: "Group 2"
date: "`r Sys.Date()`"
documentclass: article
geometry: margin=1in
fontsize: 11pt
output:
  pdf_document:
    toc: false
    df_print: kable
    fig_caption: false
    number_sections: false
    dev: pdf
    highlight: tango
  html_document:
    theme: default
    self_contained: true
    toc: false
    df_print: kable
    fig_caption: false
    number_sections: false
    smart: true
    dev: svg
---

```{r setup, include = FALSE}
# DO NOT ALTER THIS CHUNK
knitr::opts_chunk$set(
  echo = TRUE,
  eval = TRUE,
  fig.width = 5,
  fig.asp = 0.618,
  out.width = "70%",
  dpi = 120,
  fig.align = "center",
  cache = FALSE
)
is_pdf <- try (("pdf_document" %in% 
                  rmarkdown::all_output_formats(knitr::current_input())), 
               silent=TRUE)
is_pdf <- (is_pdf == TRUE)

# Load required packages
suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(broom))
suppressPackageStartupMessages(library(modelr))
suppressPackageStartupMessages(library(plotly))
suppressPackageStartupMessages(library(readxl))
suppressPackageStartupMessages(library(infer))
suppressPackageStartupMessages(library(lubridate))
suppressPackageStartupMessages(library(geosphere))
suppressPackageStartupMessages(library(lubridate))
suppressPackageStartupMessages(library(infer))
suppressPackageStartupMessages(library(usmap))
suppressPackageStartupMessages(library(ggplot2))
suppressPackageStartupMessages(library(formattable))
suppressPackageStartupMessages(library(plotrix))
suppressPackageStartupMessages(library(ggpubr))
suppressPackageStartupMessages(library(boot))
```

```{r}
library(readxl)
library(dplyr)
library(ggplot2)
library(tidyr)

data <- read_excel("WHR_2015.xlsx")

colnames(data)
```

```{r}
colnames(data) <- c("Country", "Region", "Happiness Score",
                    "Happiness Rank","Economy",
                    "Health", "Freedom", 
                    "Trust", "Family", "Generosity", 
                    "Dystopia Residual", "Standard Error") 
```

```{r}
str(data)
head(data)
tail(data)
```

*Center
```{r}
data %>%
  summarize(center = median(`Happiness Score`, na.rm = TRUE))
```

```{r}
data %>%
  summarise(mean_happiness_score = mean(`Happiness Score`, na.rm = TRUE))
```


```{r}
library(tidyr)
library(dplyr) 

happiness_long <- data %>%
  pivot_longer(
    cols = c(`Economy`, `Family`, `Health`, `Trust`, `Generosity`),
    names_to = "Variable",
    values_to = "Value"
  )

```

```{r}
library(ggplot2)

ggplot(happiness_long, aes(x = Variable, y = Value, fill = Variable)) +
  geom_boxplot(alpha = 0.6) +  
  labs(title = "Impact of Various Factors on Happiness Score",
       subtitle = "Boxplot representation of various factors influencing happiness",
       x = "Factors Influencing Happiness",
       y = "Happiness Score") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 10, hjust = 1),  
        legend.position = "none")  

```

```{r}
library(ggplot2)

ggplot(happiness_long, aes(x = Variable, y = Value, fill = Variable)) +
  geom_violin(trim = TRUE, alpha = 0.6) +  
  labs(title = "Impact of Various Factors on Happiness Score",
       subtitle = "Violin plots representing distribution of happiness factors",
       x = "Factors",
       y = "Happiness Score") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 10, hjust = 0.65, vjust = 1),  
        legend.position = "none")  

```



```{r}
cor_data <- melt(cor_matrix)

heatmap_plot <- ggplot(cor_data, aes(Var1, Var2, fill = value)) +
  geom_tile(color = "white") +  
  scale_fill_gradient2(low = "blue", high = "red", mid = "white", midpoint = 0, limit = c(-1, 1)) +
  theme_minimal() +  
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1),  
        axis.title = element_blank()) +  
  labs(fill = "Correlation")  

print(heatmap_plot)
```
* Red shows the strongest positive correlation, blue shows the strongest negative correlation, and white shows no relationship close to 0. 

* Most Influential: Economy (GDP per Capita), closely followed by Family and Health.
* Moderately Influential: Trust (Government Corruption).
* Least Influential: Generosity.


```{r}
data <- read_excel("WHR_2015.xlsx")

pie_data <- data.frame(
  variable = names(medians),
  value = as.numeric(medians),
  label = sprintf("%.1f%%", as.numeric(medians))  
)

ggplot(pie_data, aes(x = "", y = value, fill = variable)) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar(theta = "y") +
  theme_void() +
  labs(title = "Contribution of Various Factors to Happiness Score") +
  geom_text(aes(label = label), position = position_stack(vjust = 0.5), size = 3) 
```
* The size of each sector is calculated based on the median value of each variable relative to the total sum of medians. Family variable occupies the largest sector, indicating it has the most significant impact on happiness scores, contributing 34.8% of the total.
