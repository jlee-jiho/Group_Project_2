---
title: "Final Project (Group 2)"
author: "Group 2"
date: "`r Sys.Date()`"
output:
  pdf_document:
    toc: no
    df_print: kable
    fig_caption: no
    number_sections: no
    dev: pdf
    highlight: tango
  html_document:
    theme: default
    self_contained: yes
    toc: no
    df_print: kable
    fig_caption: no
    number_sections: no
    smart: yes
    dev: svg
  word_document:
    toc: no
geometry: margin=1in
fontsize: 11pt
documentclass: article
---

```{r setup, include = FALSE}
# DO NOT ALTER THIS CHUNK
knitr::opts_chunk$set(
  echo = TRUE,
  eval = TRUE,
  fig.width = 5,
  fig.asp = 0.618,
  out.width = "70%",
  dpi = 120,
  fig.align = "center",
  cache = FALSE
)
is_pdf <- try (("pdf_document" %in% 
                  rmarkdown::all_output_formats(knitr::current_input())), 
               silent=TRUE)
is_pdf <- (is_pdf == TRUE)

# Load required packages
suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(broom))
suppressPackageStartupMessages(library(modelr))
suppressPackageStartupMessages(library(plotly))
suppressPackageStartupMessages(library(readxl))
suppressPackageStartupMessages(library(infer))
suppressPackageStartupMessages(library(lubridate))
suppressPackageStartupMessages(library(geosphere))
suppressPackageStartupMessages(library(lubridate))
suppressPackageStartupMessages(library(infer))
suppressPackageStartupMessages(library(usmap))
suppressPackageStartupMessages(library(ggplot2))
suppressPackageStartupMessages(library(formattable))
suppressPackageStartupMessages(library(plotrix))
suppressPackageStartupMessages(library(ggpubr))
suppressPackageStartupMessages(library(boot))
```

-   Research Question/Hypothesis: What variable in the world happiness report (family, health, trust, generosity, and economics) has the greatest effect on a nation's happiness score?

-   Hypothesis: Economics plays the largest role in a nation's happiness score.

```{r}
library(readxl)
library(dplyr)
library(ggplot2)
library(tidyr)

data <- read_excel("2019.xls")

colnames(data)
```

```{r}
library(readxl)

data <- read_excel("2019.xls")

print(colnames(data))

data <- data %>%
  rename(
    Economy = `GDP per capita`,  
    Social = 'Social support',                      
    Health = `Healthy life expectancy`,
    Freedom = `Freedom to make life choices`,  
    Corruption = 'Perceptions of corruption', 
    Happiness_Score = `Score`
  )
print(colnames(data))

```

```{r}
  head(
    select(data, Economy, Social, Health, Freedom, Corruption, Happiness_Score)
  )
```

[Module 2: Junhyung Kim, Jiho Lee]

\*Scatter Plot

```{r}
data %>%
ggplot() +
geom_point(mapping = aes (x = Economy, y= Happiness_Score)) +
labs(title = 
       "Scatter Plot of Relationship Between 
Economy and Happiness Score",
x = "Economy", y = "Happiness Score")
```

```{r}
data %>%
ggplot() +
geom_point(mapping = aes (x = Social, y= Happiness_Score)) +
labs(title = 
       "Scatter Plot of Relationship Between 
Social and Happiness Score",
x = "Social", y = "Happiness Score")
```

```{r}
data %>%
ggplot() +
geom_point(mapping = aes (x = Health, y= Happiness_Score)) +
labs(title = 
       "Scatter Plot of Relationship Between 
Health and Happiness Score",
x = "Health", y = "Happiness Score")
```

```{r, warning = FALSE}
qplot(x = Freedom, y= Happiness_Score, data = data, 
      geom = c("point", "smooth"), method = "lm") +
labs(title = 
       "Scatter Plot of Relationship Between
Freedom and Happiness Score",
x = "Freedom", y = "Happiness Score")
```

```{r, warning = FALSE}
qplot(x = Corruption, y= Happiness_Score, data = data, 
      geom = c("point", "smooth"), method = "lm") +
labs(title = 
       "Scatter Plot of Relationship Between
Corruption and Happiness Score",
x = "Corruption", y = "Happiness Score")
```

```{r}
data %>%
  ggplot() +
  geom_smooth(mapping = aes(x = Economy, y = Happiness_Score)) +
  labs(x = "Economy", y = "Happiness Score", 
       title="Trend line relationship between 
       Economy vs Happiness Score")
```

```{r}
data %>%
  ggplot() +
  geom_smooth(mapping = aes(x = Social, y = Happiness_Score)) +
  labs(x = "Social", y = "Happiness Score", 
       title="Trend line relationship between 
       Social vs Happiness Score")
```

```{r}
data %>%
  ggplot() +
  geom_smooth(mapping = aes(x = Health, y = Happiness_Score)) +
  labs(x = "Health", y = "Happiness Score", 
       title="Trend line relationship between 
       Health vs Happiness Score")
```

```{r}
data %>%
  ggplot() +
  geom_smooth(mapping = aes(x = Freedom, y = Happiness_Score)) +
  labs(x = "Freedom", y = "Happiness Score", 
       title="Trend line relationship between 
       Freedom vs Happiness Score")
```

```{r}
data %>%
  ggplot() +
  geom_smooth(mapping = aes(x = Corruption, y = Happiness_Score)) +
  labs(x = "Corruption", y = "Happiness Score", 
       title="Trend line relationship between 
       Corruption vs Happiness Score")
```

\*HeatMap

```{r}
data %>%
ggplot() +
geom_bin2d(mapping = aes(x = Economy, y = Happiness_Score)) +
labs(title = "HeatMap (Economy and Happiness Score)",x= "Economy",
     y= "Happiness_Score")
```

```{r}
data %>%
ggplot() +
geom_bin2d(mapping = aes(x = Social, y = Happiness_Score)) +
labs(title = "HeatMap (Social and Happiness Score)",x= "Social",
     y= "Happiness_Score")
```

```{r}
data %>%
ggplot() +
geom_bin2d(mapping = aes(x = Health, y = Happiness_Score)) +
labs(title = "HeatMap (Health and Happiness Score)",x= "Health",
     y= "Happiness_Score")
```

```{r}
data %>%
ggplot() +
geom_bin2d(mapping = aes(x = Freedom, y = Happiness_Score)) +
labs(title = "HeatMap (Freedom and Happiness Score)",x= "Freedom",
     y= "Happiness_Score")
```

```{r}
data %>%
ggplot() +
geom_bin2d(mapping = aes(x = Corruption, y = Happiness_Score)) +
labs(title = "HeatMap (Corruption and Happiness Score)",x= "Corruption",
     y= "Happiness_Score")
```

```{r}
 data %>%
 pivot_longer(cols = Economy | Social | Health | Freedom |Corruption, 
              names_to = "Variable", values_to = "value") %>%
 ggplot() +
 geom_bin2d(mapping = aes(x = value, y = Happiness_Score)) +
 labs(title = "HeatMap between Variables and Happiness Score",
      x= "Variables") +
 facet_wrap(~ Variable, scales = "free_x")
```


======= [ Module 4: Eugene Kim, Harold Lee - Explanatory Data Analysis ]

```{r}
str(data)
head(
    select(data, Economy, Social, Health, Freedom, Corruption,
           Happiness_Score)
  )
tail(select(data, Economy, Social, Health, Freedom, Corruption,
            Happiness_Score)
  )
```

\*Summary statistics

\*Box Plot

```{r}
data_long <- data %>%
  gather(key = "Variable", value = "Score", Economy, Social, Health,
         Freedom, Corruption) 

ggplot(data_long, aes(x = Variable, y = Score)) +
  geom_boxplot(width = 0.7) + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(title = "Box Plot Each Variable",
       x = "Variables Affecting Happiness Score", y = "Values")
```

\*Violin Plot

```{r}
ggplot(data_long, aes(x = Variable, y = Score, fill = Variable)) +
  geom_violin(trim = TRUE) + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(title = "Violin Plot of Each Variable",
       x = "Variables Affecting Happiness Score", y = "Values") +
  scale_fill_brewer(palette = "Pastel1")
```

\*Summary

```{r}
data %>%
  summarize(
    mean= mean(Economy),
    median = median(Economy),
    sd = sd(Economy),
    iqr = IQR(Economy),
    min = min(Economy),
    max = max(Economy)
 )
```

```{r}
data %>%
  summarize(
    mean= mean(Social),
    median = median(Social),
    sd = sd(Social),
    iqr = IQR(Social),
    min = min(Social),
    max = max(Social)
 )
```

```{r}
data %>%
  summarize(
    mean= mean(Health),
    median = median(Health),
    sd = sd(Health),
    iqr = IQR(Health),
    min = min(Health),
    max = max(Health)
 )
```

```{r}
data %>%
  summarize(
    mean= mean(Freedom),
    median = median(Freedom),
    sd = sd(Freedom),
    iqr = IQR(Freedom),
    min = min(Freedom),
    max = max(Freedom)
 )
```

```{r}
data %>%
  summarize(
    mean= mean(Corruption),
    median = median(Corruption),
    sd = sd(Corruption),
    iqr = IQR(Corruption),
    min = min(Corruption),
    max = max(Corruption)
 )
```



```{r}
data_E <- data %>%
  summarize(
    mean= mean(Economy),
    median = median(Economy),
    max = max(Economy)
 )
```

```{r}
data_S <- data %>%
  summarize(
    mean= mean(Social),
    median = median(Social),
    max = max(Social)
 )
```

```{r}
data_H <- data %>%
  summarize(
    mean= mean(Health),
    median = median(Health),
    max = max(Health)
 )
```

```{r}
data_F <- data %>%
  summarize(
    mean= mean(Freedom),
    median = median(Freedom),
    max = max(Freedom)
 )
```

```{r}
data_C <- data %>%
  summarize(
    mean= mean(Corruption),
    median = median(Corruption),
    max = max(Corruption)
 )
```

```{r}
combined_data <- rbind(data_E, data_S, data_H, data_F, data_C)
combined_data$c <- c('Economy', 'Social', 'Health', 'Freedom', 'Corruption')
colnames(combined_data) <- c("Mean", "Median", "Max", "Variables")
group_data <- group_by(combined_data, Variables)
```

```{r}
group_data2 <- group_data %>%
 pivot_longer(cols = Mean:Max, names_to = "Summary_Variable" , values_to = "Value")
```


```{r}
ggplot(data=group_data2, aes(x=Variables, y=Value, group=Summary_Variable)) +
  geom_line(aes(color=Summary_Variable)) +
  geom_point(aes(color=Summary_Variable))
```


# [Module 5: Chun Jin Park - Modeling].

# linear model using Im

```{r}
model <- lm(Happiness_Score ~ Economy + Social + Health + Freedom + Generosity + Corruption, data = data)

summary(model)
```

# tidy to get the model coefficients

```{r}
coefficients <- tidy(model)
print(coefficients)
```

# glance to get the model's performance metrics

```{r}
performance <- glance(model)
print(performance)
```

# Observed vs Predicted plot

```{r}
ggplot(data, aes(x = predict(model), y = Happiness_Score)) +
  geom_point() +
  geom_abline(intercept = 0, slope = 1, col = "red") +
  labs(title = 
         "Observed vs Predicted Happiness Score", 
       x = "Predicted Happiness Score", 
       y = "Observed Happiness Score")
```

# Residuals vs Predicted plot

```{r}
ggplot(data, aes(x = predict(model), y = residuals(model))) +
  geom_point() +
  geom_hline(yintercept = 0, col = "red") +
  labs(title = "Residuals vs Predicted Happiness Score",
       x = "Predicted Happiness Score", 
       y = "Residuals")
```

# Q-Q plot

```{r}
qqnorm(residuals(model))
qqline(residuals(model), col = "red")
```
